<html>
<head>
  <title><%= title %> - Application powered by IoT for Electronics</title>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="/bootstrap/css/bootstrap-theme.min.css"/>
  <link rel="stylesheet" href="/styles/style.css"/>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/javascripts/iotAppMonitorClient.js"></script>
  <script src="/jquery/jquery.min.js"></script>
  <script src="/bootstrap/js/bootstrap.min.js"></script>
</head>
<body>
  <h4 class="bluemix-bar-header">
    <span class="bluemix-bar-header-text"><a href="javascript:window.close();">Dashboard</a><span>
  </h4>
  <h4 class="bluemix-bar">IoT for Electronics Starter Experience</h4>
  <div class="main-section">
    <div class="container">
      <h2 >What would you like to explore?</h2>
      <section class="col-xs-12 col-md-10 content">
        <div class="col-xs-12 col-sm-6 explore-info">
          <div name="selection-box-1" class="col-md-9 selection-box active">
            <img src="/images/Washer.svg"/>
            <h3 class="section-info">Simulate appliance</h3>
            <p>View and change live simulated data on an example appliance.</p>
          </div>
        </div>
        <div class="col-xs-12 col-sm-6 explore-info">
          <div name="selection-box-2" class="col-md-9 selection-box">
            <img src="/images/Phone.svg" class="mobile-image"/>
            <h3>Consumer app</h3>
            <p>See how an appliance owner benefits from connected services.</p>
          </div>
        </div>
      </section>
    </div>
  </div>
  <div class="main-section gray-background arrow-section">
    <div class="container">
      <section name="description-selection-box-1" class="col-xs-12 col-md-10 content description-box">
        <div class="col-xs-12 col-md-6">
          <img src="/images/Washer.svg"/>
          <img src="/images/SimulateAppliance_Diagram.png"/>
        </div>
        <div class="col-xs-12 col-md-6 explain">
          <p>An appliance can be connected to the
            platform so that you can view streaming
            live data. With this starter offering, you
            can create your own simulated appliances.
          </p>
          <p>You will use a web-based app that
            simulates an appliance receiving
            commands and performing operations
            connected through the IoT Platform. On
            the platform you will be able to see the
            the devices that you’ve created and the
            messages they have sent.
          </p>
          <a href="https://daily-console.stage1.ng.bluemix.net/docs/starters/IotElectronics/iotelectronics_overview.html" target="_blank"><img src="/images/LearnMoreArrow.svg"/> Learn More </a>
        </div>
      </section>
      <section name="description-selection-box-2" class="col-xs-12 col-md-10 content description-box hidden">
        <div class="col-xs-12 col-md-6 image-box-2">
          <img src="/images//Phone.svg"/>
          <img src="/images/ConsumerApp_Diagram.png"/>
        </div>
        <div class="col-xs-12 col-md-6 explain">
          <p>You will experience a simulation of how
            Heidi, an appliance owner, uses a mobile
            app for the new washer that she has
            purchased. An appliance company will be
            able to offer these types of new services
            to attract and retain customers. Future
            appliances and services can be better
            designed based on new sources of
            customer data.
          </p>
          <p>You will use a mobile app on an iOS phone.
            You will experience how Heidi can send
            commands to the appliance and receive
            updates from her appliance via the IoT
            platform and Bluemix. You can use the
            Appliance Simulator to mimic failure events
            on Heidi’s washer, then view the results in
            Heidi’s mobile app.
          </p>
          <a href="https://daily-console.stage1.ng.bluemix.net/docs/starters/IotElectronics/iotelectronics_overview.html" target="_blank"><img src="/images/LearnMoreArrow.svg"/> Learn More </a>
        </div>
      </section>
    </div>
  </div>
  <div class="main-section arrow-section">
    <div class="container">
      <section class="col-xs-12 col-md-10 content">
        <h2>Choose or add new simulated washer</h2>
        <p class="add-washer-message">You can add up to five washers.<p>
        <p class="max-washer-message hidden"><span>You have reached the limit of 5 washers.</span></p>
        <button id="addNewDeviceButton" class="add-button"><img src="/images/PlusWasher_en.svg"></button>
        <hr/>
        <div class="washer-list">
          <p class="selection-text"><strong>Your washers</strong><span>Select a washer to control its simulated data. A new window will open.</span></p>
          <p class="no-washers-message">No washers have been added</p>
          <p class="appxp-washer-message hidden">You must add a washer before continuing with the mobile app experience.</p>
          <div class="list-group">
          </div>
        </div>
      </section>
    </div>
  </div>
  <div class="installation-section hidden">
    <div class="main-section gray-background arrow-section ">
      <div class="container">
        <h2 >Next, install the mobile app on an iOS phone</h2>
        <section class="col-xs-12 col-md-10 content">
          <div class="col-xs-12 col-md-5">
            <img class="mobile-image" src="/images/Phone.svg"/>
          </div>
          <div class="col-xs-12 col-md-7 instructions-section">
            <div class="install-info">
              <h3> <img src="/images/Install_Step1.svg"/>
              Download the app to your workstation<br/>
              <a href="javascript:alert('Still to be included.');">add link here</a></h3>
            </div>
            <div class="install-info">
              <h3> <img src="/images/Install_Step2.svg"/>
              Instructions to install on your iOS phone<br/>
              <a href="https://console.stage1.ng.bluemix.net/docs/starters/IotElectronics/iote_installMobileApp.html" target="_blank">Click Here</a></h3>
            </div>
          </div>
        </section>
      </div>
    </div>
    <div class="main-section arrow-section ">
      <div class="container">
        <h2 >Last, you'll need this QR code to use the app:</h2>
        <section class="col-xs-12 col-md-10 content">
          <div class="col-xs-12 col-md-12 QR-code-info">
            <div class="col-md-12 selection-code active">
              <img src="/qr/getPlatformCredentials"/>
              <h3>Connect your mobile app</h3>
              <p>You’ll be asked to scan this code to connect your app the first time you use it.</p>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <a class="ibm-top-link hidden" aria-label="Back to top" href="#top" tabindex="0">Back to top</a>
  <script>
    $(document).ready(function(){

      // Setup the ajax indicator
      $('body').append('<div id="ajaxBusy"><p><img src="images/loading.gif"></p></div>');

      $('#addNewDeviceButton').prop('disabled', false);

      $('#ajaxBusy').css({
        display:"none",
        margin:"0px",
        paddingLeft:"0px",
        paddingRight:"0px",
        paddingTop:"0px",
        paddingBottom:"0px",
        position:"fixed",
        left:"50%",
        top:"50%",
        width:"auto"
      });


      var numberOfDevices = 0;
      var MAX_DEVICES = 5;

      $.ajax({
        url: '/washingMachine/getStatus',
        type: 'GET',
        success: function(data){
          $.each(data, function(index, value){
            numberOfDevices++;
            $('.list-group').append('<button class="list-item"><span>' + index + '</span></button>');
            if(numberOfDevices === MAX_DEVICES) {
              $('#addNewDeviceButton').prop('disabled', true);
            }
          });
          validateNoWasherMessage();
          validateMaxWasherMessage();
        }
      });

      validateAppExperienceWasherMessage();

      $(document).on('click', '#addNewDeviceButton', function(e){
        e.preventDefault();
        if(numberOfDevices < MAX_DEVICES) {
          numberOfDevices++;

          // TODO: Uncomment the snippet below (it was commented out for testing purposes)

           $.ajax({
             url: '/washingMachine/createDevices/1',
             type: 'POST',
             success: function(data){
               $.each(data, function(index, value){
                 $('.list-group').append('<button class="list-item"><span>' + value.deviceID + '</span></button>');
               });
               validateNoWasherMessage();
               validateAppExperienceWasherMessage();
             }
           });

          // TODO: Remove the snippet below (I added it for testing purposes)
          // validateNoWasherMessage();
          // validateAppExperienceWasherMessage();
          // $('.list-group').append('<button class="list-item"><span>Washer ' + numberOfDevices + '</span></button>');
          // *****


          if(numberOfDevices === MAX_DEVICES) {
            $('#addNewDeviceButton').prop('disabled', true);
            $('#addNewDeviceButton img').attr("src","../images/PlusWasher_dis.svg");
            validateMaxWasherMessage();
          }
        }
      });

      $('.washer-list .list-group').on("click", ".list-item", function(){
        $('.washer-list .list-group .list-item').removeClass('active');
        $(this).addClass('active');

        window.open(
          // TODO: Uncomment the line below and comment out the line with './washer.html'
          './washingMachine/' + $(this).find('span').text(),
          // './washer.html',
          '_blank' // <- This is what makes it open in a new window.
        );
      });

      $('.selection-box').click(function() {
        $('.selection-box').removeClass('active');
        $(this).addClass('active');
        //Change the content from the selection box
        $('.description-box').addClass('hidden');
        $('.description-box[name=description-' + $(this).attr('name') + ']').removeClass('hidden');
        validateAppExperienceWasherMessage();
      });

      $('.problem-machine-icons button').click(function() {
        $('.problem-machine-icons button').removeClass('active');
        $(this).addClass('active');
      });

      function validateAppExperienceWasherMessage(){
        var appNoWasherMessage = $('.appxp-washer-message');
        var installationSection = $('.installation-section');
        if ($('.selection-box.active').attr('name') === 'selection-box-2'){
          if(numberOfDevices < 1){
            appNoWasherMessage.removeClass('hidden');
            installationSection.addClass('hidden');
          }
          if(numberOfDevices > 0 ){
            appNoWasherMessage.addClass('hidden');
            installationSection.removeClass('hidden');
          }
        }
        else{
          appNoWasherMessage.addClass('hidden');
          installationSection.addClass('hidden');
        }
      }
      function validateNoWasherMessage(){
        var noWashersMessage = $('.washer-list .no-washers-message');
        if(numberOfDevices < 1 && noWashersMessage.hasClass("hidden")){
          noWashersMessage.removeClass('hidden');
        }
        if(numberOfDevices > 0 && !noWashersMessage.hasClass("hidden")){
          noWashersMessage.addClass('hidden');
        }
      }
      function validateMaxWasherMessage(){
        var maxMessage = $('.max-washer-message');
        var addMessage = $('.add-washer-message');
        if(numberOfDevices === MAX_DEVICES && maxMessage.hasClass('hidden')){
          maxMessage.removeClass('hidden');
          addMessage.addClass('hidden');
        }
        if(numberOfDevices < MAX_DEVICES && !maxMessage.hasClass('hidden')){
          maxMessage.addClass('hidden');
          addMessage.removeClass('hidden');
        }
      }
    });

    // Ajax activity indicator bound to ajax start/stop document events
    $(document).ajaxStart(function(){
      $('#ajaxBusy').show();
    }).ajaxStop(function(){
      $('#ajaxBusy').hide();
    });

    //Scroll page control
    $('.ibm-top-link').click(function() {
    		$('html, body').animate({scrollTop : 0},400);
    		return false;
    });

    $(window).scroll(function (event) {
        var scroll = $(window).scrollTop();
        var topLink = $('.ibm-top-link');
        if (scroll > 0){
          if(topLink.hasClass('hidden')){
            topLink.removeClass('hidden');
          }
        }
        else {
          if(!topLink.hasClass('hidden')){
            topLink.addClass('hidden');
          }
        }
    });
  </script>

</body>
</html>
